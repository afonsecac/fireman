<!DOCTYPE html >
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:f="http://java.sun.com/jsf/core">
<ui:composition template="../../template/template.xhtml">
	<ui:define name="pageTitle">
		Gestionar Solicitudes		
	</ui:define>
	<ui:define name="contenido">

		<h:form id="formList">

<!--			<p:commandButton ajax="true" update=":formList:dtList growl"-->
<!--				oncomplete="PF('dlgCreate').show()" value="Nuevo"-->
<!--				styleClass="btn btn-default" />-->

			<p:dataTable id="dtList" var="item" value="#{counterBean.requests}">
				<p:column headerText="Dirección">
					<h:outputText value="#{item.local.address}" />
				</p:column>
				<p:column headerText="Servicio">
					<h:outputText value="#{item.local.service.name}" />
				</p:column>
				<p:column headerText="Estado">
					<h:outputText value="#{item.permissionRequestStatus}" />
				</p:column>
				<p:column style="text-align: center; width: 200px"
					headerText="Acciones">

					<p:commandButton update=":formFiles:opFiles growl"
						icon="ui-icon-folder-collapsed" oncomplete="PF('dlgFiles').show()"
						title="Cargar documentos">
						<f:setPropertyActionListener value="#{item}"
							target="#{counterBean.selectedRequest}" />
					</p:commandButton>

					<p:commandButton update=":formRequest:opRequest growl"
						icon="ui-icon-clipboard" oncomplete="PF('dlgRequest').show()"
						title="Emitir permiso de funcionamiento">
						<f:setPropertyActionListener value="#{item}"
							target="#{counterBean.selectedRequest}" />
					</p:commandButton>

					<p:commandButton update=":formCancel:opCancel growl"
									 rendered="#{item.permissionRequestStatus == 'SUBMITTED' or
									 item.permissionRequestStatus == 'IN_PROGRESS' or
									 item.permissionRequestStatus == 'INSPECTED' or
									 item.permissionRequestStatus == 'CLOSED'}"
									 disabled="#{item.permissionRequestStatus == 'CLOSED'}"
									 icon="ui-icon-circle-close" oncomplete="PF('dlgCancel').show()"
									 title="Cancelar solicitud">
						<f:setPropertyActionListener value="#{item}"
													 target="#{counterBean.selectedRequest}" />
					</p:commandButton>

				</p:column>
			</p:dataTable>
		</h:form>

		<p:dialog header="Aprobar Permiso" widgetVar="dlgRequest" width="255"
			height="110" resizable="false" modal="true">
			<h:form id="formRequest">
				<p:outputPanel id="opRequest" style="text-align: center;">
					<h:outputText
						value="Está seguro que desea emitir el permiso de funcionamiento?." />
				</p:outputPanel>

				<div align="center" style="padding-top: 15px;">
					<p:commandButton ajax="true" action="faces-redirect=false"
						update="growl :formList:dtList"
						oncomplete="PF('dlgRequest').hide();"
						actionListener="#{counterBean.editRequest()}" value="SI"
						styleClass="btn btn-default" />

					<p:commandButton ajax="true" action="faces-redirect=false"
						update="growl" oncomplete="PF('dlgRequest').hide();"
						actionListener="#{counterBean.clearData()}" value="NO"
						styleClass="btn btn-default" />
				</div>
			</h:form>
		</p:dialog>

		<p:dialog header="Cargar Documentos" widgetVar="dlgFiles" width="600"
				  modal="true">
			<h:form id="formFiles" enctype="multipart/form-data">
				<p:outputPanel id="opFiles">

					<p:repeat value="#{clientLocalBean.listRequirements()}" var="item">
						<p:panelGrid columns="2" cellpadding="5" layout="grid">
							<h:outputText value="#{item.requirementName}" />
							<p:fileUpload value="#{item.file}" mode="simple"
										  skinSimple="true" label="Seleccionar" />
						</p:panelGrid>
					</p:repeat>

				</p:outputPanel>

				<div align="center" style="padding-top: 15px;">
					<p:commandButton ajax="false" action="faces-redirect=false"
									 update="growl" oncomplete="PF('dlgFiles').hide();"
									 actionListener="#{clientLocalBean.upload()}"
									 value="Guardar Documentos" styleClass="btn btn-default" />
				</div>
			</h:form>
		</p:dialog>

		<p:dialog header="Cancelar Solicitud" widgetVar="dlgCancel"
				  width="255" height="110" resizable="false" modal="true">
			<h:form id="formCancel">
				<p:outputPanel id="opCancel" style="text-align: center;">
					<h:outputText
							value="Está seguro que desea cancelar la solicitud del permiso de funcionamiento?." />
				</p:outputPanel>

				<div align="center" style="padding-top: 15px;">
					<p:commandButton ajax="true" action="faces-redirect=false"
									 update="growl :formList:dtList"
									 oncomplete="PF('dlgCancel').hide();"
									 actionListener="#{counterBean.cancelRequest()}" value="SI"
									 styleClass="btn btn-default" />

					<p:commandButton ajax="true" action="faces-redirect=false"
									 update="growl" oncomplete="PF('dlgCancel').hide();"
									 actionListener="#{counterBean.clearData()}" value="NO"
									 styleClass="btn btn-default" />
				</div>
			</h:form>
		</p:dialog>

	</ui:define>
</ui:composition>
</html>
